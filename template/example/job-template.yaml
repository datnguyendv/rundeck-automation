- defaultTab: nodes
  description: Approval for vault secret change
  executionEnabled: true
  group: approval
  loglevel: INFO
  name: Approval for execution 123
  nodeFilterEditable: true
  options:
    - name: VaultName
      value: "ct-core-job"
    - name: namespace
      value: "default"
    - name: action
      value: "create"
    - hidden: true
      name: VaultToken
      required: true
      secure: true
      storagePath: keys/project/vaul-v1/Token
      valueExposed: true
    - description: "test"
      name: GITHUB_TOKEN
      required: true
    - description: "test"
      name: NPM_TOKEN
      required: true
    - description: "test"
      name: GOOGLE_CREDS
      required: true
  plugins:
    ExecutionLifecycle: {}
  scheduleEnabled: true
  sequence:
    commands:
      - autoSecureInput: 'false'
        passSecureInput: 'false'
        script: |
          VAULT_ADDR="http://vault:8200"
          VAULT_PATH="gke/${RD_OPTION_VAULTNAME}"

          DATA={\"GITHUB_TOKEN\":\"$RD_OPTION_GITHUB_TOKEN\",\"NPM_TOKEN\":\"$RD_OPTION_NPM_TOKEN\",\"GOOGLE_CREDS\":\"$RD_OPTION_GOOGLE_CREDS\"}
          echo "$DATA"

          curl -X POST \
            -H "X-Vault-Token: $RD_OPTION_VAULTTOKEN" \
            -H "Content-Type: application/json" \
            -d "$DATA" \
            "$VAULT_ADDR/v1/$VAULT_PATH"

          echo "Approved" > /tmp/approved_marker_123
    keepgoing: false
    strategy: node-first
