{%- set env = ENV | default('dev') -%}
{%- set env_upper = env | upper -%}
{%- set env_lower = env | lower -%}

{%- if env_lower == 'dev' -%}
  {%- set domain = 'vault-cloud.chotot.org' -%}
{%- elif env_lower == 'uat' -%}
  {%- set domain = 'vault-cloud.chotot.me' -%}
{%- elif env_lower == 'prod' -%}
  {%- set domain = 'vault-cloud.chotot.com' -%}
{%- else -%}
  {%- set domain = 'vault-cloud.chotot.local' -%}
{%- endif -%}

vault_address: https://{{ domain }}
vault_token_env: CHOTOT_VAULT_GCP_{{ env_upper }}_TOKEN

k8s_cluster_env: CHOTOT_GKE_{{ env_upper }}
vault_secret_engine: gke-{{ env_lower }}
vault_k8s_auth_path: gke-{{ env_lower }}

services:
{% if action == 'recreate' %}
  - name: {{ vault_name | default('default-service') }}
    namespace: {{ namespace | default('default') }}
    action: delete
    secrets:
{% for key in vault_keys %}
      - {{ key }}
{% endfor %}

  - name: {{ vault_name | default('default-service') }}
    namespace: {{ namespace | default('default') }}
    action: create
    secrets:
{% for key in vault_keys %}
      - {{ key }}
{% endfor %}
{% else %}
  - name: {{ vault_name | default('default-service') }}
    namespace: {{ namespace | default('default') }}
    action: {{ action | default('create') }}
    secrets:
{% for key in vault_keys %}
      - {{ key }}
{% endfor %}
{% endif %}
